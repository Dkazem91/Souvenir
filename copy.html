{% extends 'base.html' %}

{% block title %}Friends{% endblock %}

{% block content %}
{% load static %}
<div class="row">
   <div class="col-md-12">
<nav class="navbar navbar-expand-md navbar-dark bg-dark">
    <div class="navbar-collapse collapse w-100 order-1 order-md-0 dual-collapse2">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link" href="{% url 'friends' user.id %}">Friends</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% url 'result' user.id %}">View Trips</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% url 'write_review' user.id %}">Review</a>
            </li>
        </ul>
    </div>
    <div class="mx-auto order-0">
        <a class="navbar-brand mx-auto" href="{% url 'home' %}">Souvenir.</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target=".dual-collapse2">
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>
    <div class="navbar-collapse collapse w-100 order-3 dual-collapse2">
        <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a class="nav-link" href="{% url 'logout' %}">Logout</a>
            </li>
        </ul>
    </div>
</nav>   
</div>
</div>
<script src="{% static 'js/script.js' %}"></script>
<link rel="stylesheet" href="{% static 'souvenir/home.css' %}">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Slabo+27px" rel="stylesheet">
<script src="https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.js"></script>
<link href="https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.css" rel='stylesheet' />

<div class="container" style="margin-top: 60px;">
 <div class="row">
   <div class="col align-self-center">
     <h1 style="text-align: center;">Looking for more inspiration {{ user.first_name }}...</h1>
     <form class="search">
       <div class="input-group input-group-lg">
        {% csrf_token %}
	<div class="ui-widget">
	  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	  <input id="friends-search-bar" user_id="{{ user.id }}" type="search" name="usr_query" value="{{ query }}" class="form-control" placeholder="enter a username or last name of who you are looking for..." aria-label="Friends" aria-describedby="basic-addon2">
         <button id="friends-search-btn" class="btn btn-outline-primary" type="submit">Search</button>
        </div>
     </form>
   </div>
 </div>
</div>



<div class="container friends-container">
  <div class="row friends container">
  </div>
</div>


<button id="friends-list-btn" class="btn btn-primary" type="submit">Friends Listing</button>

<script>

$(document).ready(function() {
   
   $(document).on('click', 'button', function() {
        if ($(this).hasClass('a')) {
            places[$(this).parent().attr('rev_id')] = [$(this).parent().attr('place_id'),
                $(this).parent().attr('user_id')
            ]
            console.log(places);
            $(this).toggleClass('a d');
                $(this).toggleClass("btn-primary btn-danger");
            $(this).text('delete');
        } else if ($(this).hasClass('d')) {
            delete places[$(this).parent().attr('rev_id')];
            console.log(places);
            $(this).toggleClass('d a');
                $(this).toggleClass("btn-primary btn-danger");
            $(this).text('add');
        }

    });
   $('#friends-search-btn').on('click', function(event){
   event.preventDefault();
   search = $('#friends-search-bar').val();
  $.ajax({
      type: 'GET',
      url: 'http://localhost:8000/souvenirapp/api/friends/' + {{user.id}} + '/' + search,
      dataType: 'json',
      contentType: 'application/json',
      success: function (data) {
        console.log(data)
        let html = '<ul>';
        for (let i of data) {
          html += '<li style="list-style-type: none;">';
          html += '<article>'; 
          html += '<h3 user_id = i.id>' + i.username + ": " + i.first_name + " " + i.last_name + '</h3>';
          html += '<button type="button" class="a btn btn-primary float-right" data-toggle="button" aria-pressed="false" autocomplete="off">'+ "ADD" + '</button>'; 
	  html += '</article>';
          html += '</li>';
        }
        html += '</ul>';
        $('.friends').html(html);  
        },
      error: function (jqXHR, textStatus, errorThrown) {
        html = '<h1>No data found</h1>';
        $('.results').html(html);
        console.log(jqXHR);
        console.log(textStatus);
        console.log(errorThrown);
      }
});
});
});


</script>


<script>
$(document).ready(function() {
let user = $('#friends-search-bar').attr('user_id');
$('#friends-list-btn').on('click', function(event){
   let user = $('#friends-search-bar').attr('user_id');
   console.log(user);
   event.preventDefault();
   $.ajax({
     type: 'GET',
     url: 'http://127.0.0.1:8000/souvenirapp/api/allfriends/' + '/' + user,
     contentType: 'application/json',
     success: function (data) {
        console.log(data);
        let html = '<ul>';
        for (let i of data) {
          html += '<li>' + i[1].name + '</li>';
        }
        html += '</ul>';
}
});
});
});
</script>



{% endblock %}
